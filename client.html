<!DOCTYPE html>
<html>
    <head>
      <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <style>
        * { margin: 0; padding: 0; }
        body { 
          font: 14px Helvetica, Arial; 
          background-color: #EEE;
        }
        form {
          padding: 5px;
          border-top: 1px solid #DDD;
        }
        .input-wrapper input { 
          border-width: 0;
          padding: 0;
          margin: 0;
          width: 100%;
          outline: none;
        }
        .input-wrapper {
          background-color: #FFF;
          border: 1px solid #AAA;
          margin: 5px;
          padding: 10px;
          -moz-border-radius: 2px;
          -webkit-border-radius: 2px;
          -o-border-radius: 2px;
          -ms-border-radius: 2px;
          -khtml-border-radius: 2px;
          border-radius: 2px;
        }
        #chatlog {
          list-style-type: none; 
          padding: 3px; 
          background-color: #FFF;
        }
        #chatlog li { 
          position: relative;
          margin: 20px;
          -moz-border-radius: 4px;
          -webkit-border-radius: 4px;
          -o-border-radius: 4px;
          -ms-border-radius: 4px;
          -khtml-border-radius: 4px;
          padding: 5px 10px; 
          background: #eee; 
        }
        #chatlog li:after {
          content:"";
          position:absolute;
          bottom: -18px;
          left:30px;
          border:9px solid transparent;
          border-top-color:#eee;
          /* reduce the damage in FF3.0 */
          display:block;
          width:0;
        }
      </style>
    </head>
    <body id="body">
      <ul id="chatlog"></ul>
      <form id="chatform" action="">
        <div class="input-wrapper">
          <input type="text" id="username" placeholder="Enter username here..."/>
        </div>
        <div class="input-wrapper">
          <input autocomplete="off" placeholder="Enter message here and press enter ..." onkeypress="sendMessage(event)" id="message_input"/>
        </div>
      </form>
      <script src="/socket.io/socket.io.js"></script>
      <script type="text/javascript">

        var socketio = io.connect(location.href);
        var chatlog = document.getElementById("chatlog");

        function addMessage(msg) {
          var li = document.createElement('li');
          li.innerHTML = msg.username + ' ('+ msg.sentOn + '): ' + msg.message;
          chatlog.appendChild(li);
          var msg = document.getElementById('message_input');
          msg.scrollIntoView(true);
          msg.focus();
        }

        socketio.on("message_to_client", function(data) {
          addMessage(data);
        });

        socketio.on("init_client", function(data) {
          var messages = data.messages || [];
          messages.map(addMessage);
        });

        function sendMessage(event) {
          if (!event || event.keyCode ===  13) {
            var msgElem = document.getElementById("message_input");
            var username = document.getElementById("username").value;
            socketio.emit("message_to_server", { 
              message : msgElem.value, 
              sentOn: new Date(),
              username: username 
            });
            msgElem.value = '';
          }
        }

      </script>
    </body>
</html>